<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dongduk.cs.ssd.summerpetstore.dao.repository.mapper.MarketMapper">   
  <cache />
  
	<!--장터에 물품 등록하기-->
	<insert id="registerItem" parameterType="dongduk.cs.ssd.summerpetstore.model.ItemModel" >
		<selectKey keyProperty="itemId" resultType="int" order="BEFORE">
			SELECT item_seq.nexval AS itemid FROM DUAL
		</selectKey>
		INSERT INTO item
		VALUES (#{itemId}, "in progress", #{itemKind}, #{iname}, #{price}, #{description}, #{isGp}, #{productId}, #{sellerInfo}, #{cname})
	</insert>
	
	<!--장터 물품 자세히 보기-->
	<select id="showInfo" >
		SELECT itemId, iname, price, description, itemKind
		FROM item
		WHERE itemId=#{itemId}
	</select>
	
	<!--장터 물품 삭제-->
	<delete id="deleteItem">
		DELETE FROM item
		WHERE = itemId = #{itemId}
	</delete>
	
	<!--장터물품 수정 -->
	<update id="updateItem" >
		UPDATE Item
		SET itemKind=#{itemKind}, iname=#{iname}, price=#{price}, description=#{description}, productId=#{productId}
		WHERE itemId=#{itemId}
	</update>
	
	<!--장터상태 수정-->
	<update id="updateItemStatus" >
		UPDATE Item
		SET istatus=#{istatus}
		WHERE itemId=#{itemId}
	</update>
	
	<!--장터검색-->
	<select id="searchItem" resultType="dongduk.cs.ssd.summerpetstore.model.ItemModel">
		SELECT itemid as itemId, iname as name, price
		FROM Item
		WHERE 1=1
			<!-- <if test='param1 != null'>
				cname=#{param1}
			</if>
			<if test='param1 != null && param2 != null'>
				cname=#{param1} AND itemkind=#{param2}
			</if>
			<if test="param1 == null && param2 != null">
				itemkind=#{param2}
			</if>
			<if test='param1 != null && param2 != null && param3 != null'>
				cname=#{param1} AND itemkind=#{param2} AND lower(name) like #{param3}
			</if>
			<if test="param1 == null && param2 == null && param3 != null">
				lower(name) like #{param3}
			</if>
			<if test="param1 == null && param2 != null && param3 != null">
				itemkind=#{param2} AND lower(name) like #{param3}
			</if>
			<if test="param1 != null && param2 == null && param3 != null">
				cname=#{param1} AND lower(name) like #{param3}
			</if>-->
			
			<if test="param1 != null">
				cname=#{param1}
			</if>
			<if test="param2 != null">
				itemkind=#{param2}
			</if>
			<if test="param3 != null">
				cname=#{param3} 
			</if>
		
	</select>

	

</mapper>