<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dongduk.cs.ssd.summerpetstore.dao.repository.mapper.MarketMapper">   
  <cache />
  
	<!--장터에 물품 등록하기-->
	<insert id="registerItem" parameterType="dongduk.cs.ssd.summerpetstore.model.ItemModel" >
		<selectKey keyProperty="itemId" resultType="int" order="BEFORE">
			SELECT item_seq.nexval AS itemid FROM DUAL
		</selectKey>
		INSERT INTO item
		VALUES (#{itemId}, "in progress", #{itemKind}, #{iname}, #{price}, #{description}, #{isGp}, #{productId}, #{sellerInfo})
	</insert>
	
	<!--장터 물품 자세히 보기-->
	<select id="showInfo" >
		SELECT itemId, iname, price, description, productId, itemKind
		FROM item
		WHERE itemId = #{itemId}
	</select>
	
	<!--장터 물품 삭제-->
	<delete id="deleteItem">
		DELETE FROM item
		WHERE = itemId = #{itemId}
	</delete>
	
	<!--장터물품 수정 -->
	<update id="updateItem" >
		UPDATE Item
		SET itemKind=#{itemKind}, iname=#{iname}, price=#{price}, description=#{description}, productId=#{productId}
		WHERE itemId=#{itemId}
	</update>
	
	<!--장터상태 수정-->
	<update id="updateItemStatus" >
		UPDATE Item
		SET istatus=#{istatus}
		WHERE itemId=#{itemId}
	</update>
	
	<!--장터검색-->
	<select id="searchItem" resultType="dongduk.cs.ssd.summerpetstore.model.ItemModel">
		SELECT i.itemid as itemId, i.iname as name, i.price as price
		FROM Item i, category c, product p
		WHERE p.categoryId = c.categoryId and p.productId = i.productId
		<if test='param1 != null'>
			AND c.cname=#{param1}
		</if>
		<if test="param2 != null">
			AND i.itemkind=#{param2}
		</if>
		<if test="param3 != null">
			AND lower(i.iname) like #{param3}
		</if>
	</select>

	

</mapper>